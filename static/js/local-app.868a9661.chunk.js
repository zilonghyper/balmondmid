(self.webpackChunkgdevelop_ide=self.webpackChunkgdevelop_ide||[]).push([[712],{80530:function(e,r,t){var n=t(74149).findGDJS,o=t(50057),a=o("path"),i=o("fs");e.exports={findJsExtensionModules:function(e){var r=e.filterExamples,t=e.onFindGDJS;return(t?t():n()).then((function(e){var t=e.gdjsRoot,n=a.join(t,"Runtime","Extensions");return console.info("Searching for JS extensions (file called JsExtension.js) in ".concat(n,"...")),new Promise((function(e,t){i.readdir(n,(function(o,s){if(o)return t(o);var u=s.filter((function(e){return!r||-1===e.indexOf("Example")}));Promise.all(u.map((function(e){return r=a.join(n,e),new Promise((function(e){var t=a.join(r,"JsExtension.js");i.stat(t,(function(r,n){return e(r?null:n.isFile()?t:null)}))}));var r}))).then((function(r){e(r.filter((function(e){return!!e})))}),t)}))}))}))}}},50790:function(e,r,t){var n=t(23570).loadExtension,o=t(50057),a=t(80530).findJsExtensionModules;e.exports=function(e){var r=e.gd,t=e.objectsEditorService,i=e.objectsRenderingService,s=e.filterExamples,u=e.onFindGDJS;return{loadAllExtensions:function(e){return a({filterExamples:s,onFindGDJS:u}).then((function(a){return Promise.all(a.map((function(a){var s=null;try{s=o(a,{rethrowException:!0})}catch(u){return{extensionModulePath:a,result:{message:"Unable to import extension. Please check for any syntax error or error that would prevent it from being run.",error:!0,rawError:u}}}return s?(t&&s.registerEditorConfigurations&&s.registerEditorConfigurations(t),i&&(s.registerInstanceRenderers&&s.registerInstanceRenderers(i),s.registerClearCache&&s.registerClearCache(i)),{extensionModulePath:a,result:n(e,r,r.JsPlatform.get(),s)}):{extensionModulePath:a,result:{error:!0,message:"Unknown error. Please check for any syntax error or error that would prevent it from being run."}}})))}),(function(e){throw console.error("Unable to find JS extensions modules"),e}))}}}},44490:function(e,r,t){"use strict";t.r(r),t.d(r,{create:function(){return uo}});var n=t(1413),o=t(28381),a=t(53047),i=t(2066),s=t(50098),u=(t(94492),t(13778),t(74165)),c=t(37762),l=t(15861),p=t(93433),f=t(36600),d=t(17037),h=t(33258),v=t(57974),m=t(50057),g=t.n(m),x=t(29439),w=t(79431),b=g()("fs"),y=g()("path");function P(e,r){return j.apply(this,arguments)}function j(){return(j=(0,l.Z)((0,u.Z)().mark((function e(r,t){var n,o,a,i,s,l,p,f,d,h;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(b&&y){e.next=2;break}return e.abrupt("return");case 2:n=y.dirname(r.getProjectFile()),o=[],a=(0,c.Z)(t.values()),e.prev=5,a.s();case 7:if((i=a.n()).done){e.next=31;break}if(s=i.value,l=s.hasAnyEmbeddedResourceOutsideProjectFolder,p=s.embeddedResources,l){e.next=11;break}return e.abrupt("continue",29);case 11:f=(0,c.Z)(p.values()),e.prev=12,h=(0,u.Z)().mark((function e(){var r,t,a,i,s,c;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((r=d.value).isOutsideProjectFolder){e.next=3;break}return e.abrupt("return",1);case 3:t=y.basename(r.fullPath),a=y.extname(t),i=y.basename(t,a),s=(0,w.Z)(i,(function(e){var r=y.join(n,e)+a;return b.existsSync(r)})),c=y.join(n,s+a),r.resourceName=s+a,o.push(b.promises.copyFile(r.fullPath,c));case 10:case"end":return e.stop()}}),e)})),f.s();case 15:if((d=f.n()).done){e.next=21;break}return e.delegateYield(h(),"t0",17);case 17:if(!e.t0){e.next=19;break}return e.abrupt("continue",19);case 19:e.next=15;break;case 21:e.next=26;break;case 23:e.prev=23,e.t1=e.catch(12),f.e(e.t1);case 26:return e.prev=26,f.f(),e.finish(26);case 29:e.next=7;break;case 31:e.next=36;break;case 33:e.prev=33,e.t2=e.catch(5),a.e(e.t2);case 36:return e.prev=36,a.f(),e.finish(36);case 39:return e.abrupt("return",Promise.all(o));case 40:case"end":return e.stop()}}),e,null,[[5,33,36,39],[12,23,26,29]])})))).apply(this,arguments)}function k(e,r){var t,n=y.dirname(e.getProjectFile()),o=new Map,a=(0,c.Z)(r);try{for(a.s();!(t=a.n()).done;){var i,s=(0,x.Z)(t.value,2),u=s[0],l=s[1].embeddedResources,p={},f=(0,c.Z)(l.values());try{for(f.s();!(i=f.n()).done;){var h=i.value,v=h.resourceKind,m=h.resourceName,g=h.relPath,w=h.fullPath;m||(m=y.relative(n,w));var b=(0,d.h)(v);if(b){if(b.setName(m),b.setFile(m),p[g]=m,o.has(w)){var P=o.get(w);P&&P.mapping&&(b.setMetadata(JSON.stringify({embeddedResourcesMapping:P.mapping})),o.delete(w))}e.getResourcesManager().addResource(b)}}}catch(j){f.e(j)}finally{f.f()}o.set(u,{mapping:p})}}catch(j){a.e(j)}finally{a.f()}return o}function Z(e,r){return S.apply(this,arguments)}function S(){return(S=(0,l.Z)((0,u.Z)().mark((function e(r,t){var n,o,a,i,s,l,p,f,d,h,m,g,x,w,P,j,k,Z,S;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(b&&y){e.next=2;break}return e.abrupt("return",null);case 2:return e.next=4,b.promises.readFile(t,"utf8");case 4:if(n=e.sent,e.prev=5,!(o=JSON.parse(n))||!o.__header__||"LDtk"!==o.__header__.app){e.next=16;break}a=y.dirname(t),i=new Map,s=!1,l=(0,c.Z)(o.defs.tilesets);try{for(l.s();!(p=l.n()).done;)(f=p.value).relPath&&(d=f.relPath,h=y.resolve(a,d),m=!(0,v.Te)(r,h),g={resourceKind:"image",relPath:d,fullPath:h,isOutsideProjectFolder:m},i.set(d,g),m&&(s=!0))}catch(u){l.e(u)}finally{l.f()}x=(0,c.Z)(o.levels);try{for(x.s();!(w=x.n()).done;)(P=w.value).bgRelPath&&(j=P.bgRelPath,k=y.resolve(a,j),Z=!(0,v.Te)(r,k),S={resourceKind:"image",relPath:j,fullPath:k,isOutsideProjectFolder:Z},i.set(P.bgRelPath,S),Z&&(s=!0))}catch(u){x.e(u)}finally{x.f()}return e.abrupt("return",{hasAnyEmbeddedResourceOutsideProjectFolder:s,embeddedResources:i});case 16:e.next=22;break;case 18:return e.prev=18,e.t0=e.catch(5),console.error("Unable to read properly the data from file ".concat(t," for use as a tilemap - ignoring any potentially embedded resources.")),e.abrupt("return",null);case 22:case"end":return e.stop()}}),e,null,[[5,18]])})))).apply(this,arguments)}function E(){return(E=(0,l.Z)((0,u.Z)().mark((function e(r,t){var n,o,a,i,s;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(b&&y){e.next=2;break}return e.abrupt("return",null);case 2:return n=t.replace(".json",".atlas"),e.next=5,new Promise((function(e){b.promises.access(n,b.constants.F_OK).then((function(){return e(!0)})).catch((function(){return e(!1)}))}));case 5:if(e.sent){e.next=9;break}return console.error("Could not find an atlas file for Spine file ".concat(t,".")),e.abrupt("return",null);case 9:return o=y.basename(n),a=new Map,i=!(0,v.Te)(r,n),s={resourceKind:"atlas",relPath:o,fullPath:n,isOutsideProjectFolder:i},a.set(o,s),e.abrupt("return",{embeddedResources:a,hasAnyEmbeddedResourceOutsideProjectFolder:i});case 15:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function F(){return(F=(0,l.Z)((0,u.Z)().mark((function e(r,t){var n,o,a,i,s,l,p,f,d,h,m,g;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(b&&y){e.next=2;break}return e.abrupt("return",null);case 2:return n=null,e.prev=3,e.next=6,b.promises.readFile(t,"utf8");case 6:n=e.sent,e.next=12;break;case 9:e.prev=9,e.t0=e.catch(3),console.error("Unable to read Spine Atlas file at path ".concat(t,":"),e.t0);case 12:if(n){e.next=14;break}return e.abrupt("return",null);case 14:if(o=/.*\.(png|jpeg|jpg)$/gm,a=n.match(o)){e.next=18;break}return e.abrupt("return",null);case 18:i=y.dirname(t),s=new Map,l=!1,p=(0,c.Z)(a);try{for(p.s();!(f=p.n()).done;)d=f.value,h=y.resolve(i,d),m=!(0,v.Te)(r,h),g={resourceKind:"image",relPath:d,fullPath:h,isOutsideProjectFolder:m},s.set(d,g),m&&(l=!0)}catch(u){p.e(u)}finally{p.f()}return e.abrupt("return",{embeddedResources:s,hasAnyEmbeddedResourceOutsideProjectFolder:l});case 24:case"end":return e.stop()}}),e,null,[[3,9]])})))).apply(this,arguments)}var D={tilemap:Z,json:Z,spine:function(e,r){return E.apply(this,arguments)},atlas:function(e,r){return F.apply(this,arguments)}},C=t(40243),R=t(32484),O=t(15684),N=t(29343),A=g()("@electron/remote"),L=A?A.dialog:null,T=g()("path"),M=function(e){var r=e.options,t=e.onChooseResources,n=e.createNewResource;return(0,N.jsx)(h.L,{onChoose:function(e){var r=e.url,o=n();o.setFile(r),o.setName(T.basename(r)),o.setOrigin("gdevelop-asset-store",r),t([o])},resourceKind:r.resourceKind})},I=[].concat((0,p.Z)(d.Q.map((function(e){var r=e.kind,t=(e.displayName,e.fileExtensions),n=e.createNewResource,o=function(){var e=(0,l.Z)((0,u.Z)().mark((function e(o){var a,s,p,f,d,h,m,g,x,w,b,y,j,Z,S,E,F,C,R,O,N,M;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=o.i18n,s=o.getLastUsedPath,p=o.setLastUsedPath,f=o.project,d=o.options,L){e.next=3;break}throw new Error("Electron dialog not supported in this environment.");case 3:return h=["openFile"],d.multiSelection&&h.push("multiSelections"),m=T.dirname(f.getProjectFile()),g=s(f,r)||m,x=A.getCurrentWindow(),e.next=10,L.showOpenDialog(x,{title:a._({id:"Choose a file"}),properties:h,filters:[{name:a._({id:"Supported files"}),extensions:t}],defaultPath:g});case 10:if(w=e.sent,(b=w.filePaths)&&b.length){e.next=14;break}return e.abrupt("return",[]);case 14:if(y=T.parse(b[0]).dir,p(f,r,y),j=b.some((function(e){return!(0,v.Te)(f,e)})),Z=new Map,S=D[r],E=function(){var e=(0,l.Z)((0,u.Z)().mark((function e(r){var t,n,o,a,i,s;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=(0,c.Z)(r.embeddedResources.values()),e.prev=1,t.s();case 3:if((n=t.n()).done){e.next=18;break}if(o=n.value,a=D[o.resourceKind]){e.next=8;break}return e.abrupt("continue",16);case 8:return i=o.fullPath,e.next=11,a(f,i);case 11:if(!(s=e.sent)){e.next=16;break}return Z.set(i,s),e.next=16,E(s);case 16:e.next=3;break;case 18:e.next=23;break;case 20:e.prev=20,e.t0=e.catch(1),t.e(e.t0);case 23:return e.prev=23,t.f(),e.finish(23);case 26:case"end":return e.stop()}}),e,null,[[1,20,23,26]])})));return function(r){return e.apply(this,arguments)}}(),!S){e.next=44;break}F=(0,c.Z)(b),e.prev=22,F.s();case 24:if((C=F.n()).done){e.next=36;break}return R=C.value,e.next=28,S(f,R);case 28:if(!(O=e.sent)){e.next=34;break}return e.next=32,E(O);case 32:Z.set(R,O),O.hasAnyEmbeddedResourceOutsideProjectFolder&&(j=!0);case 34:e.next=24;break;case 36:e.next=41;break;case 38:e.prev=38,e.t0=e.catch(22),F.e(e.t0);case 41:return e.prev=41,F.f(),e.finish(41);case 44:if(N=new Map,M=new Map,!j){e.next=54;break}if(!i.ZP.showConfirmDialog(a._({id:"This/these file(s) are outside the project folder. Would you like to make a copy of them in your project folder first (recommended)?"}))){e.next=54;break}return e.next=51,(0,v.ZC)(f,b,N);case 51:return b=e.sent,e.next=54,P(f,Z);case 54:return M=k(f,Z),e.abrupt("return",b.map((function(e){var r=n();r.setFile(T.relative(m,e)),r.setName(T.relative(m,e));var t=N.has(e)?N.get(e):e;if(t){var o=M.get(t);o&&o.mapping&&r.setMetadata(JSON.stringify({embeddedResourcesMapping:o.mapping}))}return r})));case 56:case"end":return e.stop()}}),e,null,[[22,38,41,44]])})));return function(r){return e.apply(this,arguments)}}();return{name:"local-file-opener-"+r,displayName:{id:"Choose a file"},displayTab:"import",onlyForStorageProvider:"LocalFile",kind:r,selectResourcesHeadless:o,renderComponent:function(e){return(0,N.jsx)(C.x1,{justifyContent:"center",children:(0,N.jsx)(R.Z,{primary:!0,label:e.options.multiSelection?(0,N.jsx)(f.Trans,{id:"Choose one or more files"}):(0,N.jsx)(f.Trans,{id:"Choose a file"}),onClick:(0,l.Z)((0,u.Z)().mark((function r(){var t;return(0,u.Z)().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,o({i18n:e.i18n,project:e.project,fileMetadata:e.fileMetadata,getStorageProvider:e.getStorageProvider,getLastUsedPath:e.getLastUsedPath,setLastUsedPath:e.setLastUsedPath,options:e.options});case 2:t=r.sent,e.onChooseResources(t);case 4:case"end":return r.stop()}}),r)})))})})}}}))),(0,p.Z)(d.Q.map((function(e){var r=e.kind,t=e.createNewResource;return{name:"upload-".concat(r),displayName:{id:"File(s) from your device"},displayTab:"import",onlyForStorageProvider:"Cloud",kind:r,renderComponent:function(e){return(0,N.jsx)(O.V,{createNewResource:t,onChooseResources:e.onChooseResources,options:e.options,fileMetadata:e.fileMetadata,getStorageProvider:e.getStorageProvider,automaticallyOpenInput:!!e.automaticallyOpenIfPossible},"url-chooser-".concat(r))}}}))),(0,p.Z)(d.Q.map((function(e){var r=e.kind,t=e.createNewResource;return{name:"resource-store-".concat(r),displayName:{id:"Choose from asset store"},displayTab:"standalone",kind:r,renderComponent:function(e){return(0,N.jsx)(M,{createNewResource:t,onChooseResources:e.onChooseResources,options:e.options},"resource-store-".concat(r))}}})))),U=I,_=t(4942),W=t(32705),J=t(62800),G=t(81303),B=g()("path"),H=g()("fs"),z=g()("electron"),K=z?z.ipcRenderer:null,X=function(){var e=(0,l.Z)((0,u.Z)().mark((function e(r,t){var n;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(K){e.next=2;break}throw new Error("Not supported.");case 2:return e.next=4,K.invoke("".concat(r,"-load"),t);case 4:return n=e.sent,e.abrupt("return",n);case 6:case"end":return e.stop()}}),e)})));return function(r,t){return e.apply(this,arguments)}}(),V=function(){var e=(0,l.Z)((0,u.Z)().mark((function e(r){var t,n,o,a,i,s,c,p;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=r.project,n=r.resourceNames,o=B.dirname(t.getProjectFile()),a=[],i=[],s=t.getResourcesManager(),n.forEach((function(e){if(s.hasResource(e)){var r=s.getResource(e).getFile();(0,v.PX)(r)?(0,v.Gu)(r)?console.error("Unsupported blob URL for a resource - ignoring it."):a.push({url:r,resourceName:e}):i.push({localFilePath:r,resourceName:e})}})),e.next=8,(0,G.R7)({urlContainers:a,onProgress:function(e,r){}});case 8:return c=e.sent,p=new Map,e.next=12,Promise.all(c.map(function(){var e=(0,l.Z)((0,u.Z)().mark((function e(r){var t,n;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r.error,t=r.blob,n=r.item,!t){e.next=15;break}return e.prev=2,e.t0=p,e.t1=n.resourceName,e.next=7,(0,G.oT)(t);case 7:e.t2=e.sent,e.t3={dataUrl:e.t2},e.t0.set.call(e.t0,e.t1,e.t3),e.next=15;break;case 12:e.prev=12,e.t4=e.catch(2),console.error('Unable to read data from resource "'.concat(n.resourceName,'" - ignoring it.'),e.t4);case 15:case"end":return e.stop()}}),e,null,[[2,12]])})));return function(r){return e.apply(this,arguments)}}()));case 12:return e.next=14,Promise.all(i.map(function(){var e=(0,l.Z)((0,u.Z)().mark((function e(r){var t,n,a;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=r.localFilePath,n=r.resourceName,e.prev=1,e.next=4,H.promises.readFile(B.resolve(o,t));case 4:a=e.sent,p.set(n,{localFilePath:t,dataUrl:"data:text/plain;base64,"+a.toString("base64")}),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(1),console.error('Unable to read local file "'.concat(t,'" - ignoring it.'),e.t0);case 11:case"end":return e.stop()}}),e,null,[[1,8]])})));return function(r){return e.apply(this,arguments)}}()));case 14:return e.abrupt("return",n.map((function(e){var r=p.get(e);if(!r)return{name:e,dataUrl:""};var t=r.localFilePath;return{name:e,dataUrl:r.dataUrl,localFilePath:t}})));case 15:case"end":return e.stop()}}),e)})));return function(r){return e.apply(this,arguments)}}(),Y=function(){var e=(0,l.Z)((0,u.Z)().mark((function e(r){var t,n,o,a,i,s,c,l,p,f,d,h;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=r.externalEditorName,n=r.defaultName,o=r.metadataKey,a=r.resourceKind,i=r.options,s=i.project,c=i.resourceNames,l=i.resourceManagementProps,e.next=4,V({project:s,resourceNames:c});case 4:return p=e.sent,f={singleFrame:i.extraOptions.singleFrame,externalEditorData:(0,W.Z2)(o,i.extraOptions.existingMetadata),fps:i.extraOptions.fps,isLooping:i.extraOptions.isLooping,name:i.extraOptions.name||c[0]||n,resources:p},(0,J.sY)(t),e.next=9,X(t,f);case 9:if(d=e.sent){e.next=12;break}return e.abrupt("return",null);case 12:return e.next=14,(0,W.Zv)({baseNameForNewResources:d.baseNameForNewResources,project:s,resources:d.resources,resourceKind:a});case 14:return h=e.sent,e.prev=15,e.next=18,l.onFetchNewlyAddedResources();case 18:e.next=23;break;case 20:e.prev=20,e.t0=e.catch(15),console.error("An error happened while fetching the newly added resources:",e.t0);case 23:return(0,W.$N)({modifiedResources:h,metadataKey:o,metadata:i.extraOptions.singleFrame?d.externalEditorData:null}),(0,W.TD)(h.map((function(e){return e.resource.getName()})),d.externalEditorData),e.abrupt("return",{resources:h.map((function(e){var r=e.resource,t=e.originalIndex;return{name:r.getName(),originalIndex:t}})),newName:d.baseNameForNewResources,newMetadata:(0,_.Z)({},o,d.externalEditorData)});case 26:case"end":return e.stop()}}),e,null,[[15,20]])})));return function(r){return e.apply(this,arguments)}}(),Q=[{name:"piskel-app",createDisplayName:{id:"Create with Piskel"},editDisplayName:{id:"Edit with Piskel"},kind:"image",edit:function(){var e=(0,l.Z)((0,u.Z)().mark((function e(r){return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Y({options:r,externalEditorName:"piskel",defaultName:"New image",metadataKey:"pskl",resourceKind:"image"});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(r){return e.apply(this,arguments)}}()},{name:"Jfxr",createDisplayName:{id:"Create with Jfxr"},editDisplayName:{id:"Edit with Jfxr"},kind:"audio",edit:function(){var e=(0,l.Z)((0,u.Z)().mark((function e(r){return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Y({options:r,externalEditorName:"jfxr",defaultName:"New sound effect",metadataKey:"jfxr",resourceKind:"audio"});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(r){return e.apply(this,arguments)}}()},{name:"Yarn",createDisplayName:{id:"Create with Yarn"},editDisplayName:{id:"Edit with Yarn"},kind:"json",edit:function(){var e=(0,l.Z)((0,u.Z)().mark((function e(r){return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Y({options:r,externalEditorName:"yarn",defaultName:"New dialogue tree",metadataKey:"yarn",resourceKind:"json"});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(r){return e.apply(this,arguments)}}()}],$=Q,q=t(15671),ee=t(43144),re=t(60136),te=t(29388),ne=g()("os"),oe=function(){try{return ne.userInfo().uid}catch(e){return""}},ae=g()("fs-extra"),ie=g()("path"),se=g()("os"),ue=t.g.gd,ce=ie.posix||ie,le=(0,ee.Z)((function e(r){var t=this;(0,q.Z)(this,e),this._filesToDownload={},this.getAllUrlFilesIn=function(e){var r=ce.normalize(e).replace(/\\/g,"/");return Object.keys(t._filesToDownload).filter((function(e){return 0===e.indexOf(r)})).map((function(e){return{filePath:e,url:t._filesToDownload[e]}}))},this.mkDir=function(e){if(!(0,v.PX)(e)){try{ae.mkdirsSync(e)}catch(r){return console.error("mkDir("+e+") failed: "+r),!1}return!0}},this.dirExists=function(e){return!!(0,v.PX)(e)||ae.existsSync(e)},this.clearDir=function(e){try{ae.emptyDirSync(e)}catch(r){console.error("clearDir("+e+") failed: "+r)}},this.getTempDir=function(){return ie.join(se.tmpdir(),"GDTMP-".concat(oe()))},this.fileNameFrom=function(e){return!t._downloadUrlsToLocalFiles&&(0,v.PX)(e)?e:ie.basename(e)},this.dirNameFrom=function(e){return ie.dirname(e).replace(/\\/g,"/")},this.makeAbsolute=function(e,r){return(0,v.PX)(e)?e:(t.isAbsolute(r)||(r=ie.resolve(r)),ie.resolve(r,ie.normalize(e)).replace(/\\/g,"/"))},this.makeRelative=function(e,r){return(0,v.PX)(e)?e:ie.relative(r,ie.normalize(e)).replace(/\\/g,"/")},this.isAbsolute=function(e){return!!(0,v.PX)(e)||(0===e.length||(e.length>0&&"/"===e.charAt(0)||e.length>1&&":"===e.charAt(1)))},this.copyFile=function(e,r){if((0,v.PX)(e))return!t._downloadUrlsToLocalFiles||((0,v.PX)(r)?(console.error("Destination can't be a URL in copyFile (from ".concat(e," to ").concat(r,").")),!1):(t._filesToDownload[ce.normalize(r)]=e,!0));try{e!==r&&ae.copySync(e,r)}catch(n){return console.error("copyFile("+e+", "+r+") failed: "+n),!1}return!0},this.writeToFile=function(e,r){try{ae.outputFileSync(e,r)}catch(t){return console.error("writeToFile("+e+", ...) failed: "+t),!1}return!0},this.readFile=function(e){try{return ae.readFileSync(e).toString()}catch(r){return console.error("readFile("+e+") failed: "+r),""}},this.readDir=function(e,r){r=r.toUpperCase();var t=new ue.VectorString;try{ae.existsSync(e)&&ae.readdirSync(e).forEach((function(n){0!==r.length&&-1===n.toUpperCase().indexOf(r,n.length-r.length)||t.push_back(e+"/"+n)}))}catch(n){console.error("readDir("+e+","+r+") failed: "+n)}return t},this.fileExists=function(e){var r=ce.normalize(e);if(!!t._filesToDownload[r])return!0;try{return ae.statSync(e).isFile()}catch(n){return!1}},this._downloadUrlsToLocalFiles=!!r&&r.downloadUrlsToLocalFiles})),pe=le,fe=t(74149),de=t(1773),he=t(67835),ve=t(86278),me=t(78081),ge=t(75087),xe=t(20715),we=t(24910),be=function(e){var r=e.url,t=e.size,n=void 0===t?128:t,a=o.useContext(we.Z),i=o.useRef(null);return o.useEffect((function(){var e=i.current;if(e)return xe.Z.render({text:r,radius:0,ecLevel:"L",fill:a.palette.secondary,background:null,size:n},e),function(){e.firstChild&&e.removeChild(e.firstChild)}}),[r,n,a]),(0,N.jsx)("div",{ref:i})},ye=function(e){var r=e.url,t=e.open,n=e.error,o=e.onExport,a=e.onClose,i=e.onRunPreviewLocally;if(!t)return null;var s=r?"http://".concat(r):"";return(0,N.jsxs)(de.ZP,{title:(0,N.jsx)(f.Trans,{id:"Preview"}),actions:[(0,N.jsx)(he.Z,{label:(0,N.jsx)(f.Trans,{id:"Close"}),primary:!0,onClick:a},"close")],secondaryActions:[o&&(0,N.jsx)(he.Z,{label:(0,N.jsx)(f.Trans,{id:"Export game"}),onClick:o},"export"),(0,N.jsx)(he.Z,{label:(0,N.jsx)(f.Trans,{id:"Run on this computer"}),onClick:i},"run-preview-locally")],open:t,onRequestClose:a,maxWidth:"sm",children:[n&&(0,N.jsx)(C.x1,{children:(0,N.jsx)(ve.Z,{children:(0,N.jsx)(f.Trans,{id:"Unable to start the server for the preview! Make sure that you are authorized to run servers on this computer. Otherwise, use classic preview to test your game."})})}),!n&&!r&&(0,N.jsx)(me.Z,{}),!n&&r&&(0,N.jsxs)("div",{children:[(0,N.jsx)(C.x1,{children:(0,N.jsx)(ve.Z,{children:(0,N.jsx)(f.Trans,{id:"Your preview is ready! On your mobile or tablet, open your browser and enter in the address bar:"})})}),(0,N.jsx)(ge.Z,{url:r}),s&&(0,N.jsxs)(N.Fragment,{children:[(0,N.jsx)(C.x1,{children:(0,N.jsx)(ve.Z,{children:(0,N.jsx)(f.Trans,{id:"Or flash this QR code:"})})}),(0,N.jsx)(C.x1,{justifyContent:"center",children:(0,N.jsx)(be,{url:s,size:100})})]}),(0,N.jsx)(C.x1,{children:(0,N.jsx)(ve.Z,{children:(0,N.jsx)(f.Trans,{id:"Please note that your device should be connected on the same network as this computer."})})})]})]})},Pe=t(25842),je=t.n(Pe),ke=t(79987),Ze=g()("electron"),Se=Ze?Ze.ipcRenderer:null,Ee="stopped",Fe=null,De=[],Ce=[],Re={startServer:function(){if(!Se)return Promise.reject();if("started"===Ee)return Promise.resolve();var e=new Promise((function(e,r){var t=!1;Ee="stopped",Fe=null,Se&&(Se.removeAllListeners("debugger-send-message-done"),Se.removeAllListeners("debugger-error-received"),Se.removeAllListeners("debugger-connection-closed"),Se.removeAllListeners("debugger-connection-opened"),Se.removeAllListeners("debugger-connection-errored"),Se.removeAllListeners("debugger-start-server-done"),Se.removeAllListeners("debugger-message-received")),Se.on("debugger-error-received",(function(e,n){t||(r(n),t=!0),De.forEach((function(e){return(0,e.onErrorReceived)(n)}))})),Se.on("debugger-connection-closed",(function(e,r){var t=r.id,n=Ce.indexOf(t);-1!==n&&Ce.splice(n,1),De.forEach((function(e){return(0,e.onConnectionClosed)({id:t,debuggerIds:Ce})}))})),Se.on("debugger-connection-opened",(function(e,r){var t=r.id;Ce.push(t),De.forEach((function(e){return(0,e.onConnectionOpened)({id:t,debuggerIds:Ce})}))})),Se.on("debugger-connection-errored",(function(e,r){var t=r.id,n=r.errorMessage;De.forEach((function(e){return(0,e.onConnectionErrored)({id:t,errorMessage:n})}))})),Se.on("debugger-start-server-done",(function(r,n){var o=n.address;console.info("Local preview debugger started"),Ee="started",Fe=o,t||(e(),t=!0),De.forEach((function(e){return(0,e.onServerStateChanged)()}))})),Se.on("debugger-message-received",(function(e,r){var t=r.id,n=r.message;console.info("Processing message received for debugger");try{var o=JSON.parse(n);De.forEach((function(e){return(0,e.onHandleParsedMessage)({id:t,parsedMessage:o})}))}catch(a){console.warn("Error while parsing message received from debugger client:",a)}})),Se.send("debugger-start-server")})),r=new Promise((function(e,r){setTimeout((function(){r(new Error("Debugger server not started or errored after 5s - aborting."))}),5e3)}));return Promise.race([e,r])},sendMessage:function(e,r){Se&&("stopped"!==Ee?Se.send("debugger-send-message",{id:e,message:JSON.stringify(r)}):console.error("Cannot send message when debugger server is stopped."))},getServerState:function(){return Ee},getExistingDebuggerIds:function(){return Ce},registerCallbacks:function(e){return De.push(e),function(){var r=De.indexOf(e);-1!==r&&De.splice(r,1)}}},Oe=g()("electron"),Ne=g()("path"),Ae=Oe?Oe.ipcRenderer:null,Le=t.g.gd,Te=function(e){(0,re.Z)(t,e);var r=(0,te.Z)(t);function t(){var e;(0,q.Z)(this,t);for(var n=arguments.length,o=new Array(n),a=0;a<n;a++)o[a]=arguments[a];return(e=r.call.apply(r,[this].concat(o))).canDoNetworkPreview=function(){return!0},e.canDoHotReload=function(){return!0},e.state={networkPreviewDialogOpen:!1,networkPreviewHost:null,networkPreviewPort:null,networkPreviewError:null,previewGamePath:null,previewBrowserWindowOptions:null,hotReloadsCount:0,hideMenuBar:!0,alwaysOnTop:!0},e._networkPreviewSubscriptionChecker=null,e._hotReloadSubscriptionChecker=null,e._openPreviewBrowserWindow=function(){var r=e.state,t=r.previewGamePath,n=r.previewBrowserWindowOptions;n&&t&&Ae&&Ae.invoke("preview-open",{previewBrowserWindowOptions:n,previewGameIndexHtmlPath:"file://".concat(t,"/index.html"),alwaysOnTop:e.state.alwaysOnTop,hideMenuBar:e.state.hideMenuBar})},e.closePreview=function(e){Ae&&Ae.invoke("preview-close",{windowId:e})},e._openPreviewWindow=function(r,t,n){e.setState({previewBrowserWindowOptions:{width:r.getGameResolutionWidth(),height:r.getGameResolutionHeight(),useContentSize:!0,title:"Preview of ".concat(r.getName()),backgroundColor:"#000000",webPreferences:{webSecurity:!1,nodeIntegration:!0,contextIsolation:!1}},previewGamePath:t,hideMenuBar:!n.getIsMenuBarHiddenInPreview(),alwaysOnTop:n.getIsAlwaysOnTopInPreview()},(function(){if(n.networkPreview){if(!Ae)return;Ae.removeAllListeners("serve-folder-done"),Ae.removeAllListeners("local-network-ips"),Ae.on("serve-folder-done",(function(r,t,n){t?e.setState({networkPreviewDialogOpen:!0,networkPreviewPort:null,networkPreviewHost:null,networkPreviewError:t}):e.setState({networkPreviewDialogOpen:!0,networkPreviewPort:n.port}),setTimeout((function(){return e._checkSubscriptionForNetworkPreview()}))})),Ae.on("local-network-ip",(function(r,t){e.setState({networkPreviewHost:t})})),Ae.send("serve-folder",{root:t}),Ae.send("get-local-network-ip")}else e._openPreviewBrowserWindow()}))},e._prepareExporter=function(){return(0,fe.findGDJS)().then((function(e){var r=e.gdjsRoot;console.info("GDJS found in ",r);var t=new pe({downloadUrlsToLocalFiles:!1}),n=je()(new Le.AbstractFileSystemJS,t);return{outputDir:Ne.join(n.getTempDir(),"preview"),exporter:new Le.Exporter(n,r),gdjsRoot:r}}))},e.launchPreview=function(r){var t=r.project,n=r.layout,o=r.externalLayout;return e.getPreviewDebuggerServer().startServer().catch((function(e){console.error("Unable to start the Debugger Server for the preview:",e)})).then((function(){return e._prepareExporter()})).then((function(a){var s=a.outputDir,u=a.exporter,c=a.gdjsRoot;!function(e,r){var t=performance.now();e(),r(performance.now()-t)}((function(){var a=new Le.PreviewExportOptions(t,s);a.setIsDevelopmentEnvironment(i.ZP.isDev()),a.setLayoutName(n.getName()),o&&a.setExternalLayoutName(o.getName());var l=Fe;l&&a.useWebsocketDebuggerClientWithServerAddress(l.address,""+l.port);var p=e.props.getIncludeFileHashs();for(var f in p){var d=p[f];a.setIncludeFileHash(f,d)}a.setElectronRemoteRequirePath(Ne.join(c,"../preview_node_modules","@electron/remote","renderer/index.js"));var h=e.getPreviewDebuggerServer().getExistingDebuggerIds(),v=r.hotReload&&!!h.length;a.setProjectDataOnlyExport(v&&r.projectDataOnlyExport),a.setFullLoadingScreen(r.fullLoadingScreen),r.fallbackAuthor&&a.setFallbackAuthor(r.fallbackAuthor.id,r.fallbackAuthor.username),u.exportProjectForPixiPreview(a),a.delete(),u.delete(),v?(h.forEach((function(r){e.getPreviewDebuggerServer().sendMessage(r,{command:"hotReload"})})),e.state.hotReloadsCount%16===0&&e._hotReloadSubscriptionChecker&&e._hotReloadSubscriptionChecker.checkUserHasSubscription(),e.setState((function(e){return{hotReloadsCount:e.hotReloadsCount+1}}))):e._openPreviewWindow(t,s,r)}),(function(e){return console.info("Preview took ".concat(e,"ms"))}))}))},e._checkSubscriptionForNetworkPreview=function(){return!e._networkPreviewSubscriptionChecker||e._networkPreviewSubscriptionChecker.checkUserHasSubscription()},e}return(0,ee.Z)(t,[{key:"getPreviewDebuggerServer",value:function(){return Re}},{key:"render",value:function(){var e=this,r=this.state,t=r.networkPreviewDialogOpen,n=r.networkPreviewHost,a=r.networkPreviewPort,i=r.networkPreviewError;return(0,N.jsxs)(o.Fragment,{children:[(0,N.jsx)(ke.Z,{ref:function(r){return e._networkPreviewSubscriptionChecker=r},onChangeSubscription:function(){return e.setState({networkPreviewDialogOpen:!1})},id:"Preview over wifi",title:(0,N.jsx)(f.Trans,{id:"Preview over wifi"}),mode:"try"}),(0,N.jsx)(ke.Z,{ref:function(r){return e._hotReloadSubscriptionChecker=r},id:"Hot reloading",title:(0,N.jsx)(f.Trans,{id:"Live preview (apply changes to the running preview)"}),mode:"try"}),(0,N.jsx)(ye,{open:t,url:n&&a?"".concat(n,":").concat(a):null,error:i,onClose:function(){return e.setState({networkPreviewDialogOpen:!1})},onExport:this.props.onExport,onRunPreviewLocally:this._openPreviewBrowserWindow})]})}}]),t}(o.Component),Me=t(73818),Ie=t(76349),Ue=t(19431),_e=g()("electron"),We=_e?_e.shell:null,Je=t.g.gd,Ge={name:"local-cordova",packageNameWarningType:"mobile",getInitialExportState:function(e){return{outputDir:e.getLastCompilationDirectory()}},canLaunchBuild:function(e){return!!e.outputDir},isNavigationDisabled:function(){return!1},renderHeader:function(e){var r=e.project,t=e.exportState,n=e.updateExportState;return(0,N.jsxs)(C.sg,{noMargin:!0,children:[(0,N.jsx)(C.x1,{children:(0,N.jsx)(C.sg,{noMargin:!0,children:(0,N.jsx)(Ie.if,{})})}),(0,N.jsx)(C.x1,{children:(0,N.jsx)(Me.Z,{type:"export",value:t.outputDir,defaultPath:r.getLastCompilationDirectory(),onChange:function(e){n((function(){return{outputDir:e}})),r.setLastCompilationDirectory(e)},fullWidth:!0})})]})},renderLaunchButtonLabel:function(){return(0,N.jsx)(f.Trans,{id:"Package game files"})},prepareExporter:function(e){return(0,fe.findGDJS)().then((function(e){var r=e.gdjsRoot;console.info("GDJS found in ",r);var t=new pe({downloadUrlsToLocalFiles:!0}),n=je()(new Je.AbstractFileSystemJS,t);return{exporter:new Je.Exporter(n,r),localFileSystem:t}}))},launchExport:function(){var e=(0,l.Z)((0,u.Z)().mark((function e(r,t,n){var o,a,i;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=t.exporter,a=t.localFileSystem,(i=new Je.ExportOptions(r.project,r.exportState.outputDir)).setTarget("cordova"),n&&i.setFallbackAuthor(n.id,n.username),o.exportWholePixiProject(i),i.delete(),o.delete(),e.abrupt("return",{urlFiles:a.getAllUrlFilesIn(r.exportState.outputDir)});case 8:case"end":return e.stop()}}),e)})));return function(r,t,n){return e.apply(this,arguments)}}(),launchResourcesDownload:function(){var e=(0,l.Z)((0,u.Z)().mark((function e(r,t){var n;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.urlFiles,e.next=3,(0,Ue.t)({urlContainers:n,onProgress:r.updateStepProgress,throwIfAnyError:!0});case 3:return e.abrupt("return",null);case 4:case"end":return e.stop()}}),e)})));return function(r,t){return e.apply(this,arguments)}}(),launchCompression:function(e,r){return Promise.resolve(null)},renderDoneFooter:function(e){var r=e.exportState,t=(e.onClose,function(){We&&We.openPath(r.outputDir)});return(0,N.jsx)(Ie.Eg,{renderGameButton:function(){return(0,N.jsx)(R.Z,{label:(0,N.jsx)(f.Trans,{id:"Open folder"}),primary:!0,onClick:t},"open")}})}},Be=t(41426),He=g()("electron"),ze=He?He.shell:null,Ke=t.g.gd,Xe={name:"local-electron",packageNameWarningType:"desktop",getInitialExportState:function(e){return{outputDir:e.getLastCompilationDirectory()}},canLaunchBuild:function(e){return!!e.outputDir},isNavigationDisabled:function(){return!1},renderHeader:function(e){var r=e.project,t=e.exportState,n=e.updateExportState;return(0,N.jsxs)(C.sg,{noMargin:!0,expand:!0,children:[(0,N.jsx)(C.x1,{children:(0,N.jsx)(C.sg,{noMargin:!0,children:(0,N.jsx)(Be.if,{})})}),(0,N.jsx)(C.x1,{children:(0,N.jsx)(Me.Z,{type:"export",value:t.outputDir,defaultPath:r.getLastCompilationDirectory(),onChange:function(e){n((function(){return{outputDir:e}})),r.setLastCompilationDirectory(e)},fullWidth:!0})})]})},renderLaunchButtonLabel:function(){return(0,N.jsx)(f.Trans,{id:"Package game files"})},prepareExporter:function(e){return(0,fe.findGDJS)().then((function(e){var r=e.gdjsRoot;console.info("GDJS found in ",r);var t=new pe({downloadUrlsToLocalFiles:!0}),n=je()(new Ke.AbstractFileSystemJS,t);return{exporter:new Ke.Exporter(n,r),localFileSystem:t}}))},launchExport:function(){var e=(0,l.Z)((0,u.Z)().mark((function e(r,t,n){var o,a,i;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=t.exporter,a=t.localFileSystem,(i=new Ke.ExportOptions(r.project,r.exportState.outputDir)).setTarget("electron"),n&&i.setFallbackAuthor(n.id,n.username),o.exportWholePixiProject(i),i.delete(),o.delete(),e.abrupt("return",{urlFiles:a.getAllUrlFilesIn(r.exportState.outputDir)});case 8:case"end":return e.stop()}}),e)})));return function(r,t,n){return e.apply(this,arguments)}}(),launchResourcesDownload:function(){var e=(0,l.Z)((0,u.Z)().mark((function e(r,t){var n;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.urlFiles,e.next=3,(0,Ue.t)({urlContainers:n,onProgress:r.updateStepProgress,throwIfAnyError:!0});case 3:return e.abrupt("return",null);case 4:case"end":return e.stop()}}),e)})));return function(r,t){return e.apply(this,arguments)}}(),launchCompression:function(e,r){return Promise.resolve(null)},renderDoneFooter:function(e){var r=e.exportState,t=(e.onClose,function(){ze&&ze.openPath(r.outputDir)});return(0,N.jsx)(Be.Eg,{renderGameButton:function(){return(0,N.jsx)(R.Z,{label:(0,N.jsx)(f.Trans,{id:"Open folder"}),primary:!0,onClick:t},"open")}})}},Ve=t(39935),Ye=g()("electron"),Qe=Ye?Ye.shell:null,$e=t.g.gd,qe={name:"local-html5",getInitialExportState:function(e){return{outputDir:e.getLastCompilationDirectory()}},canLaunchBuild:function(e){return!!e.outputDir},isNavigationDisabled:function(){return!1},renderHeader:function(e){var r=e.project,t=e.exportState,n=e.updateExportState;return(0,N.jsxs)(C.sg,{noMargin:!0,expand:!0,children:[(0,N.jsx)(C.x1,{children:(0,N.jsx)(Ve.if,{})}),(0,N.jsx)(C.x1,{children:(0,N.jsx)(Me.Z,{type:"export",value:t.outputDir,defaultPath:r.getLastCompilationDirectory(),onChange:function(e){n((function(){return{outputDir:e}})),r.setLastCompilationDirectory(e)},fullWidth:!0})})]})},renderLaunchButtonLabel:function(){return(0,N.jsx)(f.Trans,{id:"Export as a HTML5 game"})},prepareExporter:function(e){return(0,fe.findGDJS)().then((function(e){var r=e.gdjsRoot;console.info("GDJS found in ",r);var t=new pe({downloadUrlsToLocalFiles:!0}),n=je()(new $e.AbstractFileSystemJS,t);return{exporter:new $e.Exporter(n,r),localFileSystem:t}}))},launchExport:function(){var e=(0,l.Z)((0,u.Z)().mark((function e(r,t,n){var o,a,i;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=t.exporter,a=t.localFileSystem,i=new $e.ExportOptions(r.project,r.exportState.outputDir),n&&i.setFallbackAuthor(n.id,n.username),o.exportWholePixiProject(i),i.delete(),o.delete(),e.abrupt("return",{urlFiles:a.getAllUrlFilesIn(r.exportState.outputDir)});case 7:case"end":return e.stop()}}),e)})));return function(r,t,n){return e.apply(this,arguments)}}(),launchResourcesDownload:function(){var e=(0,l.Z)((0,u.Z)().mark((function e(r,t){var n;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.urlFiles,e.next=3,(0,Ue.t)({urlContainers:n,onProgress:r.updateStepProgress,throwIfAnyError:!0});case 3:return e.abrupt("return",null);case 4:case"end":return e.stop()}}),e)})));return function(r,t){return e.apply(this,arguments)}}(),launchCompression:function(e,r){return Promise.resolve(null)},renderDoneFooter:function(e){var r=e.exportState;e.onClose;return(0,N.jsx)(Ve.Eg,{renderGameButton:function(){return(0,N.jsx)(R.Z,{fullWidth:!0,primary:!0,onClick:function(){Qe&&Qe.openPath(r.outputDir)},label:(0,N.jsx)(f.Trans,{id:"Open the exported game folder"})})}})}},er=t(29277),rr=g()("electron"),tr=g()("@electron/remote"),nr=tr?tr.dialog:null,or={container:{position:"relative",display:"flex",alignItems:"baseline"},button:{marginLeft:10},textField:{flex:1}},ar=function(e){var r=e.value,t=e.onChange,o=e.title,a=e.message,i=e.defaultPath,s=e.fullWidth,c=e.filters,p=function(){var e=(0,l.Z)((0,u.Z)().mark((function e(){var r,n,s;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(nr&&rr){e.next=2;break}return e.abrupt("return");case 2:return r=tr.getCurrentWindow(),e.next=5,nr.showSaveDialog(r,{title:o,filters:c,message:a,defaultPath:i});case 5:n=e.sent,s=n.filePath,t(s||"");case 8:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return(0,N.jsxs)("div",{style:(0,n.Z)((0,n.Z)({},or.container),{},{width:s?"100%":void 0}),children:[(0,N.jsx)(er.ZP,{margin:"dense",style:or.textField,type:"text",translatableHintText:{id:"Choose a file"},value:r,onChange:function(e,r){return t(r)}}),(0,N.jsx)(he.Z,{label:(0,N.jsx)(f.Trans,{id:"Choose"}),style:or.button,onClick:p})]})},ir=t(20049),sr=g()("fs"),ur=(0,ir.Z)("archiver"),cr=function(e){var r=e.path,t=e.outputFilename,n=e.sizeLimit,o=ur();return new Promise((function(e,a){if(!sr||!o)return a(new Error("Archiver unavailable"));var i=sr.createWriteStream(t),s=o("zip",{zlib:{level:9}});i.on("close",(function(){var r=s.pointer();if(console.log("Archive written at ".concat(t,", ").concat(r," total bytes.")),n&&r>n){var o=Math.round(r/1e6);a(new Error("Archive is of size ".concat(o," MB, which is above the limit allowed of ").concat(n/1e6," MB.")))}e(t)})),s.on("error",(function(e){a(e)})),s.pipe(i),s.directory(r,!1),s.finalize()}))},lr=t(15745),pr=g()("path"),fr=g()("electron"),dr=g()("@electron/remote"),hr=dr?dr.app:null,vr=fr?fr.shell:null,mr=t.g.gd,gr={name:"local-facebook-instant-games",getInitialExportState:function(e){return{archiveOutputFilename:hr?pr.join(hr.getPath("documents"),"fb-instant-game.zip"):""}},canLaunchBuild:function(e){return!!e.archiveOutputFilename},isNavigationDisabled:function(){return!1},renderHeader:function(e){e.project;var r=e.exportState,t=e.updateExportState;return(0,N.jsxs)(C.sg,{noMargin:!0,expand:!0,children:[(0,N.jsx)(C.x1,{children:(0,N.jsx)(lr.if,{})}),(0,N.jsx)(C.x1,{children:(0,N.jsx)(ar,{title:"Facebook Instant Games export zip file",message:"Choose where to save the exported file for Facebook Instant Games",filters:[{name:"Compressed file for Facebook Instant Games",extensions:["zip"]}],value:r.archiveOutputFilename,defaultPath:hr?hr.getPath("documents"):"",onChange:function(e){return t((function(){return{archiveOutputFilename:e}}))},fullWidth:!0})})]})},renderLaunchButtonLabel:function(){return(0,N.jsx)(f.Trans,{id:"Package game files"})},prepareExporter:function(e){return(0,fe.findGDJS)().then((function(e){var r=e.gdjsRoot;console.info("GDJS found in ",r);var t=new pe({downloadUrlsToLocalFiles:!0}),n=je()(new mr.AbstractFileSystemJS,t),o=new mr.Exporter(n,r),a=pr.join(n.getTempDir(),"FacebookInstantGamesExport");return n.mkDir(a),n.clearDir(a),{exporter:o,localFileSystem:t,temporaryOutputDir:a}}))},launchExport:function(){var e=(0,l.Z)((0,u.Z)().mark((function e(r,t,n){var o,a,i,s;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=t.exporter,a=t.localFileSystem,i=t.temporaryOutputDir,(s=new mr.ExportOptions(r.project,i)).setTarget("facebookInstantGames"),n&&s.setFallbackAuthor(n.id,n.username),o.exportWholePixiProject(s),s.delete(),o.delete(),e.abrupt("return",{temporaryOutputDir:i,urlFiles:a.getAllUrlFilesIn(i)});case 8:case"end":return e.stop()}}),e)})));return function(r,t,n){return e.apply(this,arguments)}}(),launchResourcesDownload:function(){var e=(0,l.Z)((0,u.Z)().mark((function e(r,t){var n,o;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.temporaryOutputDir,o=t.urlFiles,e.next=3,(0,Ue.t)({urlContainers:o,onProgress:r.updateStepProgress,throwIfAnyError:!0});case 3:return e.abrupt("return",{temporaryOutputDir:n});case 4:case"end":return e.stop()}}),e)})));return function(r,t){return e.apply(this,arguments)}}(),launchCompression:function(e,r){var t=r.temporaryOutputDir;return cr({path:t,outputFilename:e.exportState.archiveOutputFilename})},renderDoneFooter:function(e){var r=e.exportState,t=(e.onClose,function(){vr&&pr&&vr.openPath(pr.dirname(r.archiveOutputFilename))});return(0,N.jsx)(lr.Eg,{renderGameButton:function(){return(0,N.jsx)(R.Z,{label:(0,N.jsx)(f.Trans,{id:"Open folder"}),primary:!0,onClick:t},"open")}})}},xr=t(10959),wr=g()("electron"),br=wr?wr.ipcRenderer:null,yr=function(e,r,t){return br?(br.removeAllListeners("local-file-upload-progress"),br.removeAllListeners("local-file-upload-done"),new Promise((function(n,o){br.on("local-file-upload-progress",(function(e,r,n){t(r,n)})),br.on("local-file-upload-done",(function(e,r){if(r)return o(r);n()})),br.send("local-file-upload",e,r)}))):Promise.reject("No support for local file upload")},Pr=t(61421),jr=g()("path"),kr=g()("os"),Zr=t.g.gd,Sr={name:"local-online-cordova",onlineBuildType:"cordova-build",limitedBuilds:!0,packageNameWarningType:"mobile",getInitialExportState:function(){return{targets:["androidApk"],keystore:"new",signingDialogOpen:!1}},canLaunchBuild:function(e,r,t){return r||""===t},isNavigationDisabled:function(e,r){return!r&&["register","export","resources-download","compress","upload"].includes(e)},renderHeader:function(e){return(0,N.jsx)(Pr.s,(0,n.Z)({},e))},renderLaunchButtonLabel:function(){return(0,N.jsx)(f.Trans,{id:"Create package for Android"})},prepareExporter:function(e){return(0,fe.findGDJS)().then((function(e){var r=e.gdjsRoot;console.info("GDJS found in ",r);var t=new pe({downloadUrlsToLocalFiles:!0}),n=je()(new Zr.AbstractFileSystemJS,t),o=new Zr.Exporter(n,r),a=jr.join(n.getTempDir(),"OnlineCordovaExport");return n.mkDir(a),n.clearDir(a),{exporter:o,localFileSystem:t,temporaryOutputDir:a}}))},launchExport:function(){var e=(0,l.Z)((0,u.Z)().mark((function e(r,t,n){var o,a,i,s;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=t.exporter,a=t.localFileSystem,i=t.temporaryOutputDir,(s=new Zr.ExportOptions(r.project,i)).setTarget("cordova"),n&&s.setFallbackAuthor(n.id,n.username),o.exportWholePixiProject(s),s.delete(),o.delete(),e.abrupt("return",{temporaryOutputDir:i,urlFiles:a.getAllUrlFilesIn(i)});case 8:case"end":return e.stop()}}),e)})));return function(r,t,n){return e.apply(this,arguments)}}(),launchResourcesDownload:function(){var e=(0,l.Z)((0,u.Z)().mark((function e(r,t){var n,o;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.temporaryOutputDir,o=t.urlFiles,e.next=3,(0,Ue.t)({urlContainers:o,onProgress:r.updateStepProgress,throwIfAnyError:!0});case 3:return e.abrupt("return",{temporaryOutputDir:n});case 4:case"end":return e.stop()}}),e)})));return function(r,t){return e.apply(this,arguments)}}(),launchCompression:function(e,r){var t=r.temporaryOutputDir,n=kr.tmpdir();return cr({path:t,outputFilename:jr.join(n,"game-archive.zip")})},launchUpload:function(e,r){return(0,xr.Zi)().then((function(t){return yr(r,t,e.updateStepProgress).then((function(){return t.key}))}))},launchOnlineBuild:function(e,r,t,n,o){var a=r.getAuthorizationHeader,i=r.firebaseUser;return i?(0,xr.$C)(a,i.uid,t,e.targets,e.keystore,n,o):Promise.reject(new Error("User is not authenticated"))}},Er=t(87335),Fr=g()("path"),Dr=g()("os"),Cr=t.g.gd,Rr={name:"local-online-electron",onlineBuildType:"electron-build",limitedBuilds:!0,packageNameWarningType:"desktop",getInitialExportState:function(){return{targets:["winExe"]}},canLaunchBuild:function(e,r,t){return!!e.targets.length&&(r||""===t)},isNavigationDisabled:function(e,r){return!r&&["register","export","resources-download","compress","upload"].includes(e)},renderHeader:function(e){return(0,N.jsx)(Er.s,(0,n.Z)({},e))},renderLaunchButtonLabel:function(){return(0,N.jsx)(f.Trans,{id:"Create installation file"})},prepareExporter:function(e){return(0,fe.findGDJS)().then((function(e){var r=e.gdjsRoot;console.info("GDJS found in ",r);var t=new pe({downloadUrlsToLocalFiles:!0}),n=je()(new Cr.AbstractFileSystemJS,t),o=new Cr.Exporter(n,r),a=Fr.join(n.getTempDir(),"OnlineElectronExport");return n.mkDir(a),n.clearDir(a),{exporter:o,localFileSystem:t,temporaryOutputDir:a}}))},launchExport:function(){var e=(0,l.Z)((0,u.Z)().mark((function e(r,t,n){var o,a,i,s;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=t.exporter,a=t.localFileSystem,i=t.temporaryOutputDir,(s=new Cr.ExportOptions(r.project,i)).setTarget("electron"),n&&s.setFallbackAuthor(n.id,n.username),o.exportWholePixiProject(s),s.delete(),o.delete(),e.abrupt("return",{temporaryOutputDir:i,urlFiles:a.getAllUrlFilesIn(i)});case 8:case"end":return e.stop()}}),e)})));return function(r,t,n){return e.apply(this,arguments)}}(),launchResourcesDownload:function(){var e=(0,l.Z)((0,u.Z)().mark((function e(r,t){var n,o;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.temporaryOutputDir,o=t.urlFiles,e.next=3,(0,Ue.t)({urlContainers:o,onProgress:r.updateStepProgress,throwIfAnyError:!0});case 3:return e.abrupt("return",{temporaryOutputDir:n});case 4:case"end":return e.stop()}}),e)})));return function(r,t){return e.apply(this,arguments)}}(),launchCompression:function(e,r){var t=r.temporaryOutputDir,n=Dr.tmpdir();return cr({path:t,outputFilename:Fr.join(n,"game-archive.zip")})},launchUpload:function(e,r){return(0,xr.Zi)().then((function(t){return yr(r,t,e.updateStepProgress).then((function(){return t.key}))}))},launchOnlineBuild:function(e,r,t,n,o){var a=r.getAuthorizationHeader,i=r.firebaseUser;return i?(0,xr.ch)(a,i.uid,t,e.targets,n,o):Promise.reject(new Error("User is not authenticated"))}},Or=t(30721),Nr=g()("path"),Ar=g()("os"),Lr=t.g.gd,Tr={name:"local-online-web",onlineBuildType:"web-build",getInitialExportState:function(){return null},canLaunchBuild:function(e,r,t){return r||""===t||"done"===t},isNavigationDisabled:function(e,r){return!r&&!["","done"].includes(e)},renderHeader:function(e){var r=e.game;return(0,N.jsx)(Or.if,{game:r})},renderLaunchButtonLabel:function(){return(0,N.jsx)(f.Trans,{id:"Generate link"})},renderCustomStepsProgress:function(e){var r=e.build,t=e.project,n=e.onSaveProject,o=e.isSavingProject,a=e.errored,i=e.exportStep;return(0,N.jsx)(C.sg,{children:(0,N.jsx)(Or.lv,{build:r,project:t,onSaveProject:n,isSavingProject:o,errored:a,exportStep:i})})},prepareExporter:function(e){return(0,fe.findGDJS)().then((function(e){var r=e.gdjsRoot;console.info("GDJS found in ",r);var t=new pe({downloadUrlsToLocalFiles:!0}),n=je()(new Lr.AbstractFileSystemJS,t),o=new Lr.Exporter(n,r),a=Nr.join(n.getTempDir(),"OnlineWebExport");return n.mkDir(a),n.clearDir(a),{exporter:o,localFileSystem:t,temporaryOutputDir:a}}))},launchExport:function(){var e=(0,l.Z)((0,u.Z)().mark((function e(r,t,n){var o,a,i,s;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=t.exporter,a=t.localFileSystem,i=t.temporaryOutputDir,s=new Lr.ExportOptions(r.project,i),n&&s.setFallbackAuthor(n.id,n.username),o.exportWholePixiProject(s),s.delete(),o.delete(),e.abrupt("return",{temporaryOutputDir:i,urlFiles:a.getAllUrlFilesIn(i)});case 7:case"end":return e.stop()}}),e)})));return function(r,t,n){return e.apply(this,arguments)}}(),launchResourcesDownload:function(){var e=(0,l.Z)((0,u.Z)().mark((function e(r,t){var n,o;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.temporaryOutputDir,o=t.urlFiles,e.next=3,(0,Ue.t)({urlContainers:o,onProgress:r.updateStepProgress,throwIfAnyError:!0});case 3:return e.abrupt("return",{temporaryOutputDir:n});case 4:case"end":return e.stop()}}),e)})));return function(r,t){return e.apply(this,arguments)}}(),launchCompression:function(e,r){var t=r.temporaryOutputDir,n=Ar.tmpdir();return cr({path:t,outputFilename:Nr.join(n,"game-archive.zip"),sizeLimit:25e7})},launchUpload:function(e,r){return(0,xr.Zi)().then((function(t){return yr(r,t,e.updateStepProgress).then((function(){return t.key}))}))},launchOnlineBuild:function(e,r,t,n,o){var a=r.getAuthorizationHeader,i=r.firebaseUser;return i?(0,xr.Bc)(a,i.uid,t,n,o):Promise.reject(new Error("User is not authenticated"))}},Mr=(0,n.Z)((0,n.Z)({},Or.O1),{},{exportPipeline:Tr}),Ir=[(0,n.Z)((0,n.Z)({},Ve.BN),{},{exportPipeline:qe}),(0,n.Z)((0,n.Z)({},Pr.V),{},{exportPipeline:Sr}),(0,n.Z)((0,n.Z)({},Er.O),{},{exportPipeline:Rr}),(0,n.Z)((0,n.Z)({},lr.xu),{},{exportPipeline:gr})],Ur=[(0,n.Z)((0,n.Z)({},Ve.BN),{},{exportPipeline:qe}),(0,n.Z)((0,n.Z)({},Ie.VU),{},{exportPipeline:Ge}),(0,n.Z)((0,n.Z)({},Be.c8),{},{exportPipeline:Xe})],_r=t(76288),Wr=t(36559),Jr=t(36262),Gr=g()("electron"),Br=g()("@electron/remote"),Hr=Br?Br.app:null,zr=Gr?Gr.ipcRenderer:null,Kr=function(e){var r=e.ipcEvent,t=e.callback,n=e.shouldApply;o.useEffect((function(){if(zr&&n){var e=function(e){for(var r=arguments.length,n=new Array(r>1?r-1:0),o=1;o<r;o++)n[o-1]=arguments[o];return t.apply(void 0,n)};return zr.on(r,e),function(){return zr.removeListener(r,e)}}}),[r,t,n])},Xr=function(e){var r=e.event,t=e.callback;o.useEffect((function(){if(Hr){var e=function(e){for(var r=arguments.length,n=new Array(r>1?r-1:0),o=1;o<r;o++)n[o-1]=arguments[o];return t.apply(void 0,n)};return Hr.on(r,e),function(){return Hr.removeListener(r,e)}}}),[r,t])},Vr=function(e){if(!e)return!1;var r=e.toLowerCase();return r.startsWith("gdevelop")&&"gdevelop dialogue tree editor (yarn)"!==r&&"gdevelop sound effects editor (jfxr)"!==r&&"gdevelop image editor (piskel)"!==r},Yr=function(e){var r=e.props,t=e.callbacks,n=e.extraCallbacks,a=r.i18n,i=r.project,s=r.canSaveProjectAs,u=r.recentProjectFiles,c=r.shortcutMap,l=r.isApplicationTopLevelMenu,p=n.onClosePreview,f=a.language,d=o.useState(!0),h=(0,x.Z)(d,2),v=h[0],m=h[1],g=o.useState(Br.getCurrentWindow().id),w=(0,x.Z)(g,2),b=w[0],y=w[1],P=!v&&p?function(){return p(b)}:null,j=o.useContext(Jr.ZP).values.useShortcutToClosePreviewWindow;Xr({event:"browser-window-focus",callback:function(e){y(e.id),m(Vr(e.title))}}),Xr({event:"browser-window-blur",callback:function(e){m(!Vr(e.title))}}),Kr({ipcEvent:"main-menu-open",callback:t.onChooseProject,shouldApply:v}),Kr({ipcEvent:"main-menu-open-recent",callback:t.onOpenRecentFile,shouldApply:v}),Kr({ipcEvent:"main-menu-save",callback:t.onSaveProject,shouldApply:v}),Kr({ipcEvent:"main-menu-save-as",callback:t.onSaveProjectAs,shouldApply:v}),Kr({ipcEvent:"main-menu-show-version-history",callback:t.onShowVersionHistory,shouldApply:v}),Kr({ipcEvent:"main-menu-close",callback:j&&P?P:t.onCloseProject,shouldApply:!(!j||!P)||v}),Kr({ipcEvent:"main-menu-close-app",callback:t.onCloseApp,shouldApply:v}),Kr({ipcEvent:"main-menu-export",callback:t.onExportProject,shouldApply:v}),Kr({ipcEvent:"main-menu-invite-collaborators",callback:t.onInviteCollaborators,shouldApply:v}),Kr({ipcEvent:"main-menu-create-template",callback:t.onCreateProject,shouldApply:v}),Kr({ipcEvent:"main-menu-create-blank",callback:t.onCreateBlank,shouldApply:v}),Kr({ipcEvent:"main-menu-open-project-manager",callback:t.onOpenProjectManager,shouldApply:v}),Kr({ipcEvent:"main-menu-open-home-page",callback:t.onOpenHomePage,shouldApply:v}),Kr({ipcEvent:"main-menu-open-debugger",callback:t.onOpenDebugger,shouldApply:v}),Kr({ipcEvent:"main-menu-open-about",callback:t.onOpenAbout,shouldApply:v}),Kr({ipcEvent:"main-menu-open-preferences",callback:t.onOpenPreferences,shouldApply:v}),Kr({ipcEvent:"main-menu-open-language",callback:t.onOpenLanguage,shouldApply:v}),Kr({ipcEvent:"main-menu-open-profile",callback:t.onOpenProfile,shouldApply:v}),Kr({ipcEvent:"main-menu-open-games-dashboard",callback:t.onOpenGamesDashboard,shouldApply:v}),Kr({ipcEvent:"update-status",callback:t.setElectronUpdateStatus,shouldApply:!0}),o.useEffect((function(){zr&&zr.send("set-main-menu",(0,Wr.c)({project:i,canSaveProjectAs:s,i18n:a,recentProjectFiles:u,shortcutMap:c,isApplicationTopLevelMenu:l}))}),[a,f,i,s,u,c,l]);var k=t.onOpenRecentFile;return(0,_r.gT)("OPEN_RECENT_PROJECT",!0,{generateOptions:o.useCallback((function(){return u.map((function(e){return{text:e.fileMetadata.fileIdentifier,handler:function(){return k(e)}}}))}),[k,u])}),null},Qr=t(50790),$r=t.n(Qr),qr=t(91479),et=t.n(qr),rt=g()("path"),tt=g()("os"),nt=g()("fs"),ot=function(e){var r=e.onWriteFile,t=rt.join(tt.tmpdir(),"GDGeneratedEventsFunctions-"+oe());nt.mkdir(t,(function(e){e&&"EEXIST"!==e.code&&console.error("Unable to create the directory where to output events functions generated code: ",e)}));var n=function(e){return"".concat(t,"/").concat(et()(e),".js")};return{getIncludeFileFor:function(e){return n(e)},writeFunctionCode:function(e,t){return new Promise((function(o,a){var i=n(e);r({includeFile:i,content:t}),nt.writeFile(i,t,(function(e){if(e)return a(e);o()}))}))},writeBehaviorCode:function(e,t){return new Promise((function(o,a){var i=n(e);r({includeFile:i,content:t}),nt.writeFile(i,t,(function(e){if(e)return a(e);o()}))}))},writeObjectCode:function(e,t){return new Promise((function(o,a){var i=n(e);r({includeFile:i,content:t}),nt.writeFile(i,t,(function(e){if(e)return a(e);o()}))}))}}},at=t(64469),it=t(90505),st=t(5712),ut=t(41006),ct=g()("fs-extra"),lt=g()("path"),pt=g()("@electron/remote"),ft=pt?pt.dialog:null,dt=(0,ee.Z)((function e(){(0,q.Z)(this,e)}));dt.chooseEventsFunctionExtensionFile=function(e){if(!ft)return Promise.reject("Not supported");var r=pt.getCurrentWindow();return ft.showSaveDialog(r,{title:"Export an extension of the project",filters:[{name:'GDevelop 5 "events based" extension',extensions:["json"]}],defaultPath:e||"Extension.json"}).then((function(e){var r=e.filePath;return r||null}))},dt.writeEventsFunctionsExtension=function(e,r){return function(e,r){if(!ct)return Promise.reject(new Error("Filesystem is not supported."));try{var t=JSON.stringify(e,null,2);return ct.ensureDir(lt.dirname(r)).then((function(){return new Promise((function(e,n){ct.writeFile(r,t,(function(r){return r?n(r):e()}))}))}))}catch(n){return Promise.reject(n)}}((0,ut.XH)(e),r).catch((function(e){throw console.error("Unable to write the events function extension:",e),e}))};var ht=g()("fs"),vt=g()("@electron/remote"),mt=vt?vt.dialog:null,gt=(0,ee.Z)((function e(){(0,q.Z)(this,e)}));gt.chooseEventsFunctionExtensionFile=function(){if(!mt)return Promise.reject("Not supported");var e=vt.getCurrentWindow();return mt.showOpenDialog(e,{title:"Import an extension in the project",properties:["openFile"],message:"Choose an extension file to import (.json file)",filters:[{name:'GDevelop 5 "events based" extension',extensions:["json"]}]}).then((function(e){var r=e.filePaths;return r&&r.length?r[0]:null}))},gt.readEventsFunctionExtensionFile=function(e){return function(e){return ht?new Promise((function(r,t){ht.readFile(e,{encoding:"utf8"},(function(n,o){if(n)return t(n);try{var a=JSON.parse(o);return r(a)}catch(i){return t(e+" is a corrupted/malformed file.")}}))})):Promise.reject("Filesystem is not supported.")}(e)};var xt,wt,bt=t(56924),yt=function(e,r){var t=r.isReferenceMagicPropertyName,n=r.getReferencePartialObject,o=r.maxUnsplitDepth;return function e(r,a){if(void 0!==o&&a>=o)return Promise.resolve();if(null!==r&&"object"===typeof r){var i=Object.keys(r);if(i)return Promise.all(i.map((function(o){var i=function(e){return!0===e[t]?e:null}(r[o]);return i?n(i.referenceTo).then((function(t){return r[o]=t,e(r[o],a+1)})):e(r[o],a+1)}))).then((function(){}))}return Promise.resolve()}(e,0)},Pt=function(e){var r={};return function(t,n){var o=t[e];if("string"!==typeof o)throw new Error("Property ".concat(e," is not a string"));r[n]=r[n]||{};var a=(0,w.Z)(et()(o),(function(e){return!!r[n][e]}));return r[n][a]=!0,a}},jt=g()("fs"),kt=g()("path"),Zt=g()("@electron/remote"),St=Zt?Zt.dialog:null,Et=function(e){return jt?new Promise((function(r,t){jt.readFile(e,{encoding:"utf8"},(function(n,o){if(n)return t(n);try{var a=JSON.parse(o);return r(a)}catch(i){return t(e+" is a corrupted/malformed file.")}}))})):Promise.reject("Filesystem is not supported.")},Ft=function(){if(!St)return Promise.reject("Not supported");var e=Zt.getCurrentWindow();return St.showOpenDialog(e,{title:"Open a project",properties:["openFile"],message:"If you want to open your GDevelop 4 project, be sure to save it as a .json file",filters:[{name:"GDevelop 5 project",extensions:["json"]}]}).then((function(e){var r=e.filePaths;return r&&r.length?{fileIdentifier:r[0]}:null}))},Dt=function(e){var r=e.fileIdentifier,t=kt.dirname(r);return Et(r).then((function(e){return yt(e,{getReferencePartialObject:function(e){return Et(kt.join(t,e)+".json")},isReferenceMagicPropertyName:"__REFERENCE_TO_SPLIT_OBJECT",maxUnsplitDepth:3}).then((function(){return{content:e}}))}))},Ct=function(){var e=(0,l.Z)((0,u.Z)().mark((function e(r,t){var n,o,a,i;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=r.fileIdentifier,o=n+".autosave",!jt.existsSync(o)){e.next=15;break}if(a=jt.statSync(o).mtime.getTime(),t){e.next=6;break}return e.abrupt("return",a);case 6:return e.prev=6,i=jt.statSync(n).mtime.getTime(),e.abrupt("return",a>i+5e3?a:null);case 11:return e.prev=11,e.t0=e.catch(6),console.error("Unable to compare *.autosave to project",e.t0),e.abrupt("return",null);case 15:return e.abrupt("return",null);case 16:case"end":return e.stop()}}),e,null,[[6,11]])})));return function(r,t){return e.apply(this,arguments)}}(),Rt=function(e){return Promise.resolve((0,n.Z)((0,n.Z)({},e),{},{fileIdentifier:e.fileIdentifier+".autosave"}))},Ot=g()("fs-extra"),Nt=g()("path"),At=g()("@electron/remote"),Lt=At?At.dialog:null,Tt=["layouts","externalLayouts","externalEvents","eventsFunctionsExtensions"],Mt=function(e,r){var t=performance.now();return new Promise((function(n,o){Ot.readFile(e,{encoding:"utf8"},(function(a,i){if(a)return o(a);""===i&&o(new Error("Written file is empty, did the write fail?")),i!==r&&o(new Error("Written file is not containing the expected content, did the write fail?"));var s=performance.now()-t;console.info("Verified ".concat(e," content in ").concat(s.toFixed(),"ms.")),n()}))}))},It=function(){var e=(0,l.Z)((0,u.Z)().mark((function e(r,t){return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Ot){e.next=2;break}throw new Error("Filesystem is not supported.");case 2:if(""!==r){e.next=4;break}throw new Error("The content to save on disk is empty. Aborting.");case 4:return e.next=6,Ot.ensureDir(Nt.dirname(t));case 6:return e.next=8,Ot.writeFile(t,r);case 8:return e.next=10,Mt(t,r);case 10:case"end":return e.stop()}}),e)})));return function(r,t){return e.apply(this,arguments)}}(),Ut=function(){var e=(0,l.Z)((0,u.Z)().mark((function e(r,t){var n;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=JSON.stringify(r,null,2),e.next=3,It(n,t);case 3:case"end":return e.stop()}}),e)})));return function(r,t){return e.apply(this,arguments)}}(),_t=function(e,r,t){var n,o=(0,ut.XH)(e);if(e.isFolderProject()){var a=function(e,r){var t=r.pathSeparator,n=r.getArrayItemReferenceName,o=r.shouldSplit,a=r.isReferenceMagicPropertyName,i=[],s=function(e,r){var t;return i.push({reference:e,object:r}),t={},(0,_.Z)(t,a,!0),(0,_.Z)(t,"referenceTo",e),t};return function e(r,a,i){if(null!==r&&"object"===typeof r)if(Array.isArray(r))for(var u in r){var c=a+t+"*";if(o(c)){var l=r[u],p=n(l,i),f=i+t+p;r[u]=s(f,l),e(l,c,f)}else{var d=i+t+u;e(r[u],c,d)}}else for(var h in r){var v=a+t+h,m=i+t+h;if(o(v)){var g=r[h];r[h]=s(m,g),e(g,v,m)}else e(r[h],v,m)}}(e,"",""),i}(o,{pathSeparator:"/",getArrayItemReferenceName:Pt("name"),shouldSplit:(n=new Set(Tt.map((function(e){return"/".concat(e,"/*")}))),function(e){return n.has(e)}),isReferenceMagicPropertyName:"__REFERENCE_TO_SPLIT_OBJECT"});return Promise.all(a.map((function(e){return Ut(e.object,Nt.join(t,e.reference)+".json").catch((function(e){throw console.error("Unable to write a partial file:",e),e}))}))).then((function(){return Ut(o,r).catch((function(e){throw console.error("Unable to write the split project:",e),e}))}))}return Ut(o,r).catch((function(e){throw console.error("Unable to write the project:",e),e}))},Wt=function(e,r){var t=r.fileIdentifier,o=Date.now();if(!t)return Promise.reject('Project file is empty, "Save as" should have been called?');var a=(0,n.Z)((0,n.Z)({},r),{},{name:e.getName(),gameId:e.getProjectUuid(),lastModifiedDate:o}),i=Nt.dirname(t);return _t(e,t,i).then((function(){return{wasSaved:!0,fileMetadata:a}}))},Jt=function(){var e=(0,l.Z)((0,u.Z)().mark((function e(r){var t,n,o,a,i;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r.project,t=r.fileMetadata,n=t?t.fileIdentifier:"",o=At.getCurrentWindow(),a={defaultPath:n,filters:[{name:"GDevelop 5 project",extensions:["json"]}]},Lt){e.next=6;break}throw new Error("Unsupported");case 6:if(i=Lt.showSaveDialogSync(o,a)){e.next=9;break}return e.abrupt("return",{saveAsLocation:null});case 9:return e.abrupt("return",{saveAsLocation:{fileIdentifier:i}});case 10:case"end":return e.stop()}}),e)})));return function(r){return e.apply(this,arguments)}}(),Gt=function(){var e=(0,l.Z)((0,u.Z)().mark((function e(r,t,n){var o,a,i;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}throw new Error("A location was not chosen before saving as.");case 2:if(o=t.fileIdentifier){e.next=5;break}throw new Error("A file path was not chosen before saving as.");case 5:return n.onStartSaving(),a={fileIdentifier:o,name:r.getName(),gameId:r.getProjectUuid(),lastModifiedDate:Date.now()},e.next=9,n.onMoveResources({newFileMetadata:a});case 9:return i=Nt.dirname(o),r.setProjectFile(o),e.next=13,_t(r,o,i);case 13:return e.abrupt("return",{wasSaved:!0,fileMetadata:a});case 14:case"end":return e.stop()}}),e)})));return function(r,t,n){return e.apply(this,arguments)}}(),Bt=function(e,r){var t=r.fileIdentifier+".autosave";return It((0,ut.h_)(e),t).catch((function(e){throw console.error("Unable to write ".concat(t,":"),e),e}))},Ht=function(e){return{id:"An error occurred when saving the project. Please try again by choosing another location."}},zt=/\\ | \/ | : | \* | \? | " | < | > | \|/g,Kt=/\s+/g,Xt=function(e){var r=e.projectName,t=e.saveAsLocation,n=e.newProjectsDefaultFolder,o=t?Nt.dirname(t.fileIdentifier):n||"",a=r?function(e){return(e.length>200?e.substring(0,200):e).replace(zt," ").replace(Kt," ").trim()}(r)+".json":"game.json";return{fileIdentifier:Nt.join(o,a)}},Vt=function(e){if(!At)return!1;var r=At.app.getPath("exe");if(!r)return!1;var t=Nt.dirname(r);return e.startsWith(t)},Yt=t(78118),Qt=o.memo((function(e){return(0,N.jsx)(Yt.Z,(0,n.Z)((0,n.Z)({},e),{},{viewBox:"0 0 16 16",style:{fill:"none"},children:(0,N.jsx)("path",{d:"M5.75 11.25C5.75 11.25 6 14.25 4 15.25H12C10 14.25 10.25 11.25 10.25 11.25M5.75 11.25H13.25C14.3546 11.25 15.25 10.3546 15.25 9.25V2.75C15.25 1.64543 14.3546 0.75 13.25 0.75H2.75C1.64543 0.75 0.75 1.64543 0.75 2.75V9.25C0.75 10.3546 1.64543 11.25 2.75 11.25H5.75Z",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})}))})),$t=t(18455),qt=t.g.gd,en=(0,ir.Z)("glob"),rn=g()("path"),tn=g()("@electron/remote"),nn=function(){var e=(0,l.Z)((0,u.Z)().mark((function e(r){var t,n,o,a,i,s,c,l,f,d;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=r.project,n=r.extensions,o=r.createResource,a=en()){e.next=4;break}return e.abrupt("return");case 4:return i=t.getResourcesManager(),s=rn.dirname(t.getProjectFile()),c=[].concat((0,p.Z)(n),(0,p.Z)(n.map((function(e){return e.toUpperCase()})))),e.prev=7,e.next=10,new Promise((function(e,r){a(s+"/**/*.{"+c.join(",")+"}",(function(t,n){t?r(t):e(n)}))}));case 10:l=e.sent,f=new qt.VectorString,l.forEach((function(e){return f.push_back(rn.relative(s,e))})),d=t.getResourcesManager().findFilesNotInResources(f),f.delete(),(0,$t.mapVector)(d,(function(e){var r=(0,w.Z)(e,(function(e){return i.hasResource(e)})),n=o();n.setFile(e),n.setName(r),(0,v.r3)(t,n),i.addResource(n),n.delete(),console.info('"'.concat(e,'" added to project as resource named "').concat(r,'".'))})),e.next=22;break;case 18:return e.prev=18,e.t0=e.catch(7),console.error("Error finding files inside ".concat(s,":"),e.t0),e.abrupt("return");case 22:case"end":return e.stop()}}),e,null,[[7,18]])})));return function(r){return e.apply(this,arguments)}}(),on=t(71046),an=t.n(on),sn=t(85166),un=t.n(sn),cn=t(43734),ln=t.n(cn),pn=g()("path"),fn=g()("electron"),dn=fn?fn.ipcRenderer:null,hn=dn&&pn?function(e){var r=e.fileIdentifier,t=e.callback,n=e.options,o=un()(ln()((function(){return an()((function(e){var r=pn.relative(a,e).replace(/\\/g,"/");t({identifier:r})}),200,{leading:!1,trailing:!0})})),(function(e,r){return e(r)(r)})),a=pn.dirname(r),i=pn.basename(r),s=i+".autosave";dn.on("project-file-changed",(function(e,r){o(r)}));var u=["**/.DS_Store","**/.git/**",pn.join(a,i),pn.join(a,s)];n&&n.isProjectSplitInMultipleFiles&&u.push.apply(u,(0,p.Z)(Tt.map((function(e){return pn.join(a,e,"*.json")}))));var c=dn.invoke("local-filesystem-watcher-setup",a,JSON.stringify({ignore:u}));return function(){dn.removeAllListeners("project-file-changed"),c.then((function(e){dn.invoke("local-filesystem-watcher-disable",e)}))}}:void 0,vn={internalName:"LocalFile",name:{id:"Your computer"},renderIcon:function(e){return(0,N.jsx)(Qt,{fontSize:e.size})},getFileMetadataFromAppArguments:function(e){return e[i.rM]&&e[i.rM].length?{fileIdentifier:e[i.rM][0]}:null},getProjectLocation:Xt,renderNewProjectSaveAsLocationChooser:function(e){var r=e.projectName,t=e.saveAsLocation,n=e.setSaveAsLocation,o=e.newProjectsDefaultFolder,a=Xt({projectName:r,saveAsLocation:t,newProjectsDefaultFolder:o});return(0,N.jsx)(Me.Z,{fullWidth:!0,value:Nt.dirname(a.fileIdentifier),onChange:function(e){var t=Nt.join(e,Nt.basename(a.fileIdentifier));n(Xt({projectName:r,saveAsLocation:{fileIdentifier:t},newProjectsDefaultFolder:o}))},type:"create-game"})},setupResourcesWatcher:hn,createOperations:function(){return{onOpenWithPicker:Ft,onOpen:Dt,getAutoSaveCreationDate:Ct,onSaveProject:Wt,onChooseSaveProjectAsLocation:Jt,onSaveProjectAs:Gt,onAutoSaveProject:Bt,onGetAutoSave:Rt,getOpenErrorMessage:function(e){return{id:"Check that the file exists, that this file is a proper game created with GDevelop and that you have the authorization to open it."}},getWriteErrorMessage:Ht,canFileMetadataBeSafelySaved:function(){var e=(0,l.Z)((0,u.Z)().mark((function e(r,t){var n;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=r.fileIdentifier,!Vt(n)){e.next=4;break}return e.next=4,t.showAlert({title:{id:"Choose another location"},message:{id:"Your project is saved in the same folder as the application. This folder will be deleted when the application is updated. Please choose another location if you don't want to lose your project."}});case 4:return e.abrupt("return",!0);case 5:case"end":return e.stop()}}),e)})));return function(r,t){return e.apply(this,arguments)}}(),canFileMetadataBeSafelySavedAs:function(){var e=(0,l.Z)((0,u.Z)().mark((function e(r,t){var n;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=r.fileIdentifier,!Vt(n)){e.next=5;break}return e.next=4,t.showAlert({title:{id:"Choose another location"},message:{id:"Your project is saved in the same folder as the application. This folder will be deleted when the application is updated. Please choose another location if you don't want to lose your project."}});case 4:return e.abrupt("return",!1);case 5:return e.abrupt("return",!0);case 6:case"end":return e.stop()}}),e)})));return function(r,t){return e.apply(this,arguments)}}()}},createResourceOperations:function(){return function(e){var r=e.project,t=e.resource,n=e.i18n,o=e.updateInterface,a=e.cleanUserSelectionOfResources,i=e.informUser;return[{label:n._({id:"Locate file"}),click:function(){return function(e){var r=e.project,t=e.resource,n=(0,v.U3)(r,t.getName());tn.shell.showItemInFolder(rn.resolve(n))}({project:r,resource:t})}},{label:n._({id:"Open file"}),click:function(){return function(e){var r=e.project,t=e.resource,n=(0,v.U3)(r,t.getName());tn.shell.openPath(rn.resolve(n))}({project:r,resource:t})}},{label:n._({id:"Copy file path"}),click:function(){!function(e){var r=e.project,t=e.resource,n=(0,v.U3)(r,t.getName());tn.clipboard.writeText(rn.resolve(n))}({project:r,resource:t}),i({message:(0,N.jsx)(f.Trans,{id:"Resource file path copied to clipboard"})})}},{type:"separator"},{label:n._({id:"Scan in the project folder for..."}),submenu:d.Q.map((function(e){var t=e.displayName,a=e.fileExtensions,i=e.createNewResource;return{label:n._(t),click:function(){var e=(0,l.Z)((0,u.Z)().mark((function e(){return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,nn({project:r,extensions:a,createResource:i});case 2:o();case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()}}))},{label:n._({id:"Remove resources with invalid path"}),click:function(){!function(e){var r=e.project,t=r.getResourcesManager();t.getAllResourceNames().toJSArray().filter((function(e){return"error"===(0,v.iz)(r,e)})).forEach((function(e){t.removeResource(e),console.info("Removed due to invalid path: "+e)}))}({project:r}),a(),o()}}]}}},mn=g()("electron"),gn=mn?mn.ipcRenderer:null,xn=function(){var e=o.useContext(Jr.ZP).values.useGDJSDevelopmentWatcher;return o.useEffect((function(){if(e){if(gn)return gn.send("setup-local-gdjs-development-watcher"),function(){gn.send("close-local-gdjs-development-watcher")};console.error("Unable to find ipcRenderer to set up GDJS development watchers")}}),[e]),null},wn=t(32438),bn=t(8018),yn=t(38428),Pn=t.n(yn),jn=t(997),kn=t(36465),Zn=t(84140),Sn=t(72702),En=t(34517),Fn=t(14446),Dn=t.n(Fn),Cn=g()("electron"),Rn=Cn?Cn.ipcRenderer:null,On=g()("fs-extra"),Nn=g()("path"),An=function(e,r,t){var n=Nn.extname(t),o=Nn.basename(t,n),a=(0,w.Z)(o,(function(t){var o=Nn.join(e,t)+n;return On.existsSync(o)||r.has(o)}));return Nn.join(e,a)+n},Ln=function(){var e=(0,l.Z)((0,u.Z)().mark((function e(r,t){var n,o;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Rn){e.next=2;break}throw new Error("Not supported");case 2:return e.next=4,Dn().get(r,{responseType:"arraybuffer"});case 4:return n=e.sent,o=n.data,e.next=8,Rn.invoke("local-file-save-from-arraybuffer",o,t);case 8:case"end":return e.stop()}}),e)})));return function(r,t){return e.apply(this,arguments)}}(),Tn=function(){var e=(0,l.Z)((0,u.Z)().mark((function e(r){var t,n,o,a,i,s,c,p,f,d,h,m,g;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=r.project,n=r.fileMetadata,o=r.onProgress,a=r.authenticatedUser,On&&Rn){e.next=3;break}throw new Error("Unsupported");case 3:return i=t.getResourcesManager(),s=i.getAllResourceNames().toJSArray(),c=s.filter((function(e){var r=i.getResource(e).getFile();return(0,v.PX)(r)})),e.next=8,(0,kn._w)({authenticatedUser:a,allResourcePaths:c.map((function(e){return i.getResource(e).getFile()}))});case 8:return p=e.sent,f=Nn.dirname(n.fileIdentifier),d=Nn.join(f,"assets"),h=new Set,m=[],g=0,e.next=16,Pn().withConcurrency(50).for(c).process(function(){var e=(0,l.Z)((0,u.Z)().mark((function e(r){var t,n,a,s,x,w,b,y;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=i.getResource(r),n=t.getFile(),!(0,v.PX)(n)){e.next=30;break}if(!(0,v.Gu)(n)){e.next=19;break}return e.prev=4,a=(0,v.OI)(t),s=a.localFilePath,x=a.extension,w=s?Nn.resolve(f,s):An(d,h,(0,Sn.B)(t.getName()+(x||""))),e.next=9,On.ensureDir(d);case 9:return e.next=11,Ln(n,w);case 11:t.setFile(Nn.relative(f,w).replace(/\\/g,"/")),e.next=17;break;case 14:e.prev=14,e.t0=e.catch(4),m.push({resourceName:r,error:e.t0});case 17:e.next=30;break;case 19:return b=(0,kn.bW)(n)?(0,kn.jV)(n):(0,Zn.d0)(n)?(0,Zn.Lj)(n):(0,En.dh)(n),y=An(d,h,b),h.add(y),e.prev=22,e.next=25,(0,jn.x)({times:2},(0,l.Z)((0,u.Z)().mark((function e(){var r,o;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,On.ensureDir(d);case 2:return r=new URL(n),(0,kn.uG)(r.href)&&p&&r.searchParams.set("token",p),o=r.href,e.next=7,Rn.invoke("local-file-download",o,y);case 7:t.setFile(Nn.relative(f,y).replace(/\\/g,"/"));case 8:case"end":return e.stop()}}),e)}))));case 25:e.next=30;break;case 27:e.prev=27,e.t1=e.catch(22),m.push({resourceName:r,error:e.t1});case 30:o(g++,c.length);case 31:case"end":return e.stop()}}),e,null,[[4,14],[22,27]])})));return function(r){return e.apply(this,arguments)}}());case 16:return e.abrupt("return",{erroredResources:m});case 17:case"end":return e.stop()}}),e)})));return function(r){return e.apply(this,arguments)}}(),Mn=t(10822),In=t(85919),Un=function(){var e=(0,l.Z)((0,u.Z)().mark((function e(r,t){var n,o,a,i,s,c;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=t.transformItem,o=t.isChunkTooBig,a=t.processChunk,i=0,s=[];case 3:if(!(i<r.length)){e.next=20;break}return e.next=6,n(r[i]);case 6:if(c=e.sent,s.length){e.next=10;break}e.next=16;break;case 10:if(o([].concat(s,[c]))){e.next=13;break}e.next=16;break;case 13:return e.next=15,a(s);case 15:s.length=0;case 16:s.push(c),i++,e.next=3;break;case 20:if(!s.length){e.next=24;break}return e.next=23,a(s);case 23:s.length=0;case 24:return e.abrupt("return");case 25:case"end":return e.stop()}}),e)})));return function(r,t){return e.apply(this,arguments)}}(),_n=g()("path"),Wn=g()("fs"),Jn=function(){var e=(0,l.Z)((0,u.Z)().mark((function e(r){var t,n;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,new Promise((function(e,t){Wn.readFile(r,(function(r,n){r?t(r):e(n)}))}));case 2:return t=e.sent,n=t.buffer.slice(t.byteOffset,t.byteOffset+t.byteLength),e.abrupt("return",n);case 5:case"end":return e.stop()}}),e)})));return function(r){return e.apply(this,arguments)}}(),Gn={aac:"audio/aac",wav:"audio/wav",mp3:"audio/mp3",ogg:"audio/ogg",png:"image/png",jpg:"image/jpeg",jpeg:"image/jpeg",webp:"image/webp",ttf:"font/ttf",otf:"font/otf",mp4:"video/mp4",webm:"video/webm",json:"application/json",xml:"application/xml",gz:"application/gzip",js:"application/javascript"},Bn=function(){var e=(0,l.Z)((0,u.Z)().mark((function e(r){var t,n;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Jn(r);case 2:return t=e.sent,n=_n.extname(r).replace(/^\./,""),e.abrupt("return",new File([t],_n.basename(r),{type:Gn[n]||"application/octet-stream"}));case 5:case"end":return e.stop()}}),e)})));return function(r){return e.apply(this,arguments)}}(),Hn=g()("path"),zn=t.g.gd,Kn=function(){var e=(0,l.Z)((0,u.Z)().mark((function e(r){var t,n,o,a,i,s,c,p,f,d,h;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=r.project,n=r.authenticatedUser,o=r.oldFileMetadata,a=r.newFileMetadata,i=r.onProgress,s={erroredResources:[]},c=a.fileIdentifier,p=t.getResourcesManager(),f=function(e){return p.getAllResourceNames().toJSArray().map((function(e){var r=p.getResource(e),t=r.getFile();return(0,v.PX)(t)?(0,In.yk)(t)?null:(0,v.Gu)(t)?(s.erroredResources.push({resourceName:r.getName(),error:new Error("Unsupported blob URL.")}),null):null:r})).filter(Boolean)}(),d=Hn.dirname(o.fileIdentifier),h=0,e.next=10,Un(f,{transformItem:function(){var e=(0,l.Z)((0,u.Z)().mark((function e(r){var t,n;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=Hn.resolve(d,r.getFile()),e.prev=1,e.next=4,Bn(t);case 4:return n=e.sent,e.abrupt("return",{resource:r,file:n});case 8:return e.prev=8,e.t0=e.catch(1),s.erroredResources.push({resourceName:r.getName(),error:new Error("Unable to open the file (".concat(t,")."))}),e.abrupt("return",null);case 12:case"end":return e.stop()}}),e,null,[[1,8]])})));return function(r){return e.apply(this,arguments)}}(),isChunkTooBig:function(e){return e.length>70||e.filter(Boolean).reduce((function(e,r){return e+r.file.size}),0)>15e7},processChunk:function(){var e=(0,l.Z)((0,u.Z)().mark((function e(r){var t,o;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=r.filter(Boolean),e.next=3,(0,En.LG)(n,c);case 3:return e.next=5,(0,En.ll)(n,c,t.map((function(e){return e.file})),(function(e,r){i(h+e,f.length)}));case 5:o=e.sent,h+=r.length,o.forEach((function(e,r){var n=e.url,o=e.error,a=t[r].resource;!o&&n?a.setFile(n):s.erroredResources.push({resourceName:a.getName(),error:o||new Error("Unknown error during upload.")})}));case 8:case"end":return e.stop()}}),e)})));return function(r){return e.apply(this,arguments)}}()});case 10:return e.abrupt("return",s);case 11:case"end":return e.stop()}}),e)})));return function(r){return e.apply(this,arguments)}}(),Xn=(xt={},(0,_.Z)(xt,"".concat(vn.internalName,"=>").concat(vn.internalName),function(){var e=(0,l.Z)((0,u.Z)().mark((function e(r){var t,n,o,a;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=r.project,n=r.newFileMetadata,o=Hn.dirname(n.fileIdentifier),a=je()(new zn.AbstractFileSystemJS,new pe),zn.ProjectResourcesCopier.copyAllResourcesTo(t,a,o,!0,!1,!0),e.abrupt("return",{erroredResources:[]});case 5:case"end":return e.stop()}}),e)})));return function(r){return e.apply(this,arguments)}}()),(0,_.Z)(xt,"".concat(wn.Z.internalName,"=>").concat(vn.internalName),(function(e){var r=e.project,t=e.newFileMetadata,n=e.onProgress,o=e.authenticatedUser;return Tn({project:r,fileMetadata:t,onProgress:n,authenticatedUser:o})})),(0,_.Z)(xt,"".concat(bn.Z.internalName,"=>").concat(vn.internalName),(function(e){var r=e.project,t=e.newFileMetadata,n=e.onProgress,o=e.authenticatedUser;return Tn({project:r,fileMetadata:t,onProgress:n,authenticatedUser:o})})),(0,_.Z)(xt,"".concat(vn.internalName,"=>").concat(wn.Z.internalName),Kn),(0,_.Z)(xt,"".concat(wn.Z.internalName,"=>").concat(wn.Z.internalName),Mn.G),(0,_.Z)(xt,"".concat(bn.Z.internalName,"=>").concat(wn.Z.internalName),Mn.G),xt),Vn={moveAllProjectResources:function(){var e=(0,l.Z)((0,u.Z)().mark((function e(r){var t,n,o;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=r.oldStorageProvider,n=r.newStorageProvider,o=Xn["".concat(t.internalName,"=>").concat(n.internalName)]){e.next=4;break}throw new Error("Can't find a ResourceMover for ".concat(t.internalName," to ").concat(n.internalName,"."));case 4:return e.abrupt("return",o(r));case 5:case"end":return e.stop()}}),e)})));return function(r){return e.apply(this,arguments)}}()},Yn=Vn,Qn=t(58271),$n=t(527),qn=(wt={},(0,_.Z)(wt,wn.Z.internalName,$n.f),(0,_.Z)(wt,vn.internalName,Tn),(0,_.Z)(wt,bn.Z.internalName,Qn.j),wt),eo={fetchAllProjectResources:function(){var e=(0,l.Z)((0,u.Z)().mark((function e(r){var t,n;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=r.storageProvider,n=qn[t.internalName]){e.next=4;break}throw new Error("Can't find a ResourceFetcher for ".concat(t.internalName," - have you registered the storage provider here?"));case 4:return e.abrupt("return",n(r));case 5:case"end":return e.stop()}}),e)})));return function(r){return e.apply(this,arguments)}}()},ro=eo,to=t(71445),no=t(1333),oo=i.ZP.isDev()?"http://editor-local.gdevelop.io:3000":"https://editor.gdevelop.io",ao=function(){function e(r){(0,q.Z)(this,e),this.auth=r}return(0,ee.Z)(e,[{key:"loginWithEmailAndPassword",value:function(){var e=(0,l.Z)((0,u.Z)().mark((function e(r){var t,n;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=r.email,n=r.password,e.prev=1,e.next=4,(0,to.e5)(this.auth,t,n);case 4:e.next=10;break;case 6:throw e.prev=6,e.t0=e.catch(1),console.error("Error while login:",e.t0),e.t0;case 10:case"end":return e.stop()}}),e,this,[[1,6]])})));return function(r){return e.apply(this,arguments)}}()},{key:"loginOrSignupWithProvider",value:function(){var e=(0,l.Z)((0,u.Z)().mark((function e(r){var t,n,o=this;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r.provider,!(t=r.signal)||!t.aborted){e.next=3;break}return e.abrupt("return",Promise.reject(new Error("Login or Signup with provider already aborted.")));case 3:return n=new Promise((function(e,r){t&&t.addEventListener("abort",(function(){r(new Error("Login or Signup with provider aborted."))})),(0,no.TW)({onConnectionEstablished:function(e){if(!t||!t.aborted){var r=new URL(oo);r.searchParams.set("initial-dialog","login"),r.searchParams.set("connection-id",e),i.ZP.openExternalURL(r.toString())}},onTokenReceived:function(){var n=(0,l.Z)((0,u.Z)().mark((function n(a){return(0,u.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(!t||!t.aborted){n.next=2;break}return n.abrupt("return");case 2:return n.prev=2,n.next=5,(0,to._p)(o.auth,a);case 5:e(),(0,no.gD)(),n.next=13;break;case 9:n.prev=9,n.t0=n.catch(2),console.error("An error occurred while logging in with custom token:",n.t0),r();case 13:case"end":return n.stop()}}),n,null,[[2,9]])})));return function(e){return n.apply(this,arguments)}}(),onError:function(e){t&&t.aborted||(console.error("An error occurred while setting up authentication web socket:",e),r())}})})),e.abrupt("return",n);case 5:case"end":return e.stop()}}),e)})));return function(r){return e.apply(this,arguments)}}()},{key:"notifyLogin",value:function(){var e=(0,l.Z)((0,u.Z)().mark((function e(r){return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.warn("notifyLogin not implemented in LocalLoginProvider.");case 1:case"end":return e.stop()}}),e)})));return function(r){return e.apply(this,arguments)}}()}]),e}(),io=ao,so=t.g.gd,uo=function(e){i.ZP.setUpContextMenu();var r=new io(e.auth);e.setLoginProvider(r);var t=i.ZP.getArguments(),o=i.ZP.isDev();return(0,N.jsx)(st.Z,{authentication:e,disableCheckForUpdates:!!t["disable-update-check"],makeEventsFunctionCodeWriter:ot,eventsFunctionsExtensionWriter:dt,eventsFunctionsExtensionOpener:gt,children:function(e){var r=e.i18n;return(0,N.jsx)(bt.Z,{appArguments:t,storageProviders:[vn,bn.Z,wn.Z],defaultStorageProvider:vn,children:function(e){var t=e.getStorageProviderOperations,i=e.getStorageProviderResourceOperations,u=e.storageProviders,c=e.initialFileMetadataToOpen,l=e.getStorageProvider;return(0,N.jsx)(a.Z,{i18n:r,renderMainMenu:function(e,r,t){return(0,N.jsx)(Yr,{props:e,callbacks:r,extraCallbacks:t})},renderPreviewLauncher:function(e,r){return(0,N.jsx)(Te,(0,n.Z)((0,n.Z)({},e),{},{ref:r}))},renderShareDialog:function(e){return(0,N.jsx)(s.Z,{project:e.project,onSaveProject:e.onSaveProject,isSavingProject:e.isSavingProject,onChangeSubscription:e.onChangeSubscription,onClose:e.onClose,automatedExporters:Ir,manualExporters:Ur,onlineWebExporter:Mr,fileMetadata:e.fileMetadata,storageProvider:e.storageProvider,initialTab:e.initialTab})},renderGDJSDevelopmentWatcher:o?function(){return(0,N.jsx)(xn,{})}:null,storageProviders:u,resourceMover:Yn,resourceFetcher:ro,getStorageProviderOperations:t,getStorageProviderResourceOperations:i,getStorageProvider:l,resourceSources:U,resourceExternalEditors:$,extensionsLoader:$r()({gd:so,objectsEditorService:at.Z,objectsRenderingService:it.Z,filterExamples:!o}),initialFileMetadataToOpen:c})}})}})}}}]);
//# sourceMappingURL=local-app.868a9661.chunk.js.map